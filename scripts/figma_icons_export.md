# Экспорт иконок из Figma в SVG

Этот скрипт позволяет выгрузить иконки из Figma компонентов в формате SVG и разместить их в папке `assets/icons`.

## Требования

1. **Figma API Token** - получить можно в настройках Figma:
   - Откройте Figma → Settings → Account
   - Найдите раздел "Personal access tokens"
   - Создайте новый токен

2. **jq** - утилита для работы с JSON:
   ```bash
   # macOS
   brew install jq
   
   # Ubuntu/Debian
   sudo apt-get install jq
   ```

3. **File ID** - ID файла Figma, который можно найти в URL:
   ```
   https://www.figma.com/file/FILE_ID/название-файла
   ```

## Использование

### Базовый пример (выгрузить все компоненты)

```bash
./scripts/figma_icons_export.sh <FIGMA_TOKEN> <FILE_ID>
```

### С фильтром по имени компонента

```bash
./scripts/figma_icons_export.sh <FIGMA_TOKEN> <FILE_ID> "Icons"
```

Это выгрузит только те компоненты, имя которых содержит "Icons" (регистр не важен).

### С указанием папки для сохранения

```bash
./scripts/figma_icons_export.sh <FIGMA_TOKEN> <FILE_ID> "Icons" assets/icons
```

По умолчанию иконки сохраняются в `assets/icons`.

### С указанием начального Node ID

Если нужно выгружать иконки только из определенного раздела Figma файла, можно указать Node ID:

```bash
./scripts/figma_icons_export.sh <FIGMA_TOKEN> <FILE_ID> "" assets/icons "0:123"
```

Это начнет поиск компонентов с указанного узла вместо всего документа.

## Примеры

```bash
# Выгрузить все компоненты
./scripts/figma_icons_export.sh figd_abcdef123... ABC123XYZ

# Выгрузить только компоненты с именем, содержащим "Icon"
./scripts/figma_icons_export.sh figd_abcdef123... ABC123XYZ "Icon"

# Выгрузить в другую папку
./scripts/figma_icons_export.sh figd_abcdef123... ABC123XYZ "" assets/svg_icons

# Выгрузить иконки из конкретного раздела (используя Node ID)
./scripts/figma_icons_export.sh figd_abcdef123... ABC123XYZ "" assets/icons "0:123"
```

## Как это работает

1. Скрипт запрашивает структуру файла из Figma API
2. Находит все компоненты (COMPONENT) и наборы компонентов (COMPONENT_SET)
3. Фильтрует компоненты по имени (если указан фильтр)
4. Запрашивает экспорт выбранных компонентов в формате SVG через Figma Images API
5. Скачивает SVG файлы и сохраняет их в указанную папку
6. Нормализует имена файлов (убирает спецсимволы, приводит к нижнему регистру)

## Результат

Иконки будут сохранены в папке `assets/icons` с именами вида:
- `icon_home.svg`
- `icon_settings.svg`
- `arrow_left.svg`

Имена автоматически нормализуются:
- Пробелы заменяются на подчеркивания
- Спецсимволы удаляются
- Буквы приводятся к нижнему регистру

## Настройка Flutter проекта

После экспорта иконки автоматически добавлены в `pubspec.yaml`:

```yaml
flutter:
  assets:
    - assets/icons/
```

Теперь вы можете использовать иконки в Flutter:

```dart
import 'package:flutter/services.dart';

// Загрузка SVG как строка
final String svgString = await rootBundle.loadString('assets/icons/icon_home.svg');

// Или использовать пакет flutter_svg
SvgPicture.asset('assets/icons/icon_home.svg')
```

## Как найти Node ID

Node ID нужен для указания конкретного раздела Figma файла, с которого начинать поиск компонентов. Есть несколько способов:

1. **Через Figma API** - используйте скрипт `figma_full_file.sh` для получения полной структуры файла, затем найдите нужный узел
2. **Через браузер** - откройте Figma в браузере, выберите элемент и посмотрите в URL или в DevTools
3. **Через плагины Figma** - некоторые плагины показывают Node ID выбранных элементов

Обычно Node ID имеет формат `0:123` или `1:456` (число:число).

## Устранение проблем

### Ошибка "jq не установлен"
Установите jq согласно инструкциям выше.

### Ошибка "Превышен лимит запросов"
Figma API имеет лимиты на количество запросов. Подождите несколько минут и повторите попытку.

### Компоненты не найдены
- Убедитесь, что компоненты действительно являются компонентами (не просто фреймами)
- Проверьте правильность FILE_ID
- Попробуйте убрать фильтр по имени, чтобы увидеть все компоненты
- Если используете START_NODE_ID, проверьте правильность Node ID

### Узел с Node ID не найден
- Убедитесь, что Node ID корректен и существует в файле
- Node ID чувствителен к регистру и должен точно соответствовать ID в Figma
- Попробуйте сначала получить полную структуру файла через `figma_full_file.sh`

### URL не найден для компонента
Иногда Figma не может экспортировать некоторые компоненты (например, если они пустые или имеют проблемы). Такие компоненты будут пропущены.

